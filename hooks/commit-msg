#!/bin/sh
# 企业级 Git 提交信息校验钩子
# 遵循 Angular 规范，适配原生 JS 项目

COMMIT_MSG=$(cat "$1")
VALID_TYPES="feat|fix|docs|style|refactor|test|chore|perf|revert"

# --------------------------
# 校验规则 1：格式必须为「type: subject」
# --------------------------
PATTERN="^($VALID_TYPES): .+"
if ! echo "$COMMIT_MSG" | grep -qE "$PATTERN"; then
  echo "❌ 提交信息格式错误！"
  echo "✅ 正确格式：<type>: <subject>（例如：fix: 修复原生 JS 事件绑定失效问题）"
  echo "🔧 支持的类型："
  echo "  feat: 新增功能"
  echo "  fix: 修复 Bug"
  echo "  docs: 仅修改文档"
  echo "  style: 代码格式调整（不影响逻辑）"
  echo "  refactor: 代码重构（无功能变更）"
  echo "  test: 新增/修改测试代码"
  echo "  chore: 杂项（如修改配置）"
  echo "  perf: 性能优化"
  echo "  revert: 回滚提交"
  exit 1
fi

# --------------------------
# 校验规则 2：subject 长度不超过 50 字符
# --------------------------
SUBJECT=$(echo "$COMMIT_MSG" | cut -d ':' -f 2 | xargs)
if [ ${#SUBJECT} -gt 50 ]; then
  echo "❌ 提交信息描述过长（当前 ${#SUBJECT} 字符），请精简到 50 字符以内！"
  exit 1
fi

# --------------------------
# 校验规则 3：subject 首字母小写
# --------------------------
FIRST_CHAR=$(echo "$SUBJECT" | cut -c1)
if [ "$FIRST_CHAR" = "$(echo "$FIRST_CHAR" | tr '[:lower:]' '[:upper:]')" ]; then
  echo "❌ 提交信息描述首字母请使用小写（例如：fix: 修复登录按钮问题）"
  exit 1
fi

echo "✅ 提交信息校验通过！"
exit 0